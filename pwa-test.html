<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .icon-item {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
        }
        .icon-item img {
            width: 48px;
            height: 48px;
        }
    </style>
</head>
<body>
    <h1>üîß PWA Test Tool</h1>
    <p>–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î PWA –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è iOS —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ</p>

    <div id="tests"></div>

    <h2>üì± –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ —ñ–∫–æ–Ω–∫–∏</h2>
    <div class="icon-grid" id="icons"></div>

    <h2>üìã Manifest.json</h2>
    <pre id="manifest-content"></pre>

    <script>
        const testsContainer = document.getElementById('tests');
        const iconsContainer = document.getElementById('icons');
        const manifestContainer = document.getElementById('manifest-content');

        function addTest(name, condition, details = '') {
            const div = document.createElement('div');
            div.className = `test-result ${condition ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${condition ? '‚úÖ' : '‚ùå'} ${name}</strong>
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            testsContainer.appendChild(div);
        }

        function addInfo(message) {
            const div = document.createElement('div');
            div.className = 'test-result info';
            div.innerHTML = `<strong>‚ÑπÔ∏è ${message}</strong>`;
            testsContainer.appendChild(div);
        }

        // Test PWA features
        async function runTests() {
            // Test Service Worker
            const hasServiceWorker = 'serviceWorker' in navigator;
            addTest('Service Worker Support', hasServiceWorker);

            if (hasServiceWorker) {
                try {
                    const registration = await navigator.serviceWorker.register('/push-app/sw.js');
                    addTest('Service Worker Registration', true, 'Registered successfully');
                } catch (error) {
                    addTest('Service Worker Registration', false, error.message);
                }
            }

            // Test manifest
            try {
                const manifestResponse = await fetch('/push-app/manifest.json');
                const manifest = await manifestResponse.json();
                addTest('Manifest.json –¥–æ—Å—Ç—É–ø–Ω–∏–π', manifestResponse.ok);
                
                if (manifestResponse.ok) {
                    addTest('Manifest –º–∞—î –Ω–∞–∑–≤—É', !!manifest.name);
                    addTest('Manifest –º–∞—î —ñ–∫–æ–Ω–∫–∏', manifest.icons && manifest.icons.length > 0);
                    addTest('Manifest standalone mode', manifest.display === 'standalone');
                    
                    manifestContainer.textContent = JSON.stringify(manifest, null, 2);
                }
            } catch (error) {
                addTest('Manifest.json –¥–æ—Å—Ç—É–ø–Ω–∏–π', false, error.message);
            }

            // Test iOS detection
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome|CriOS|FxiOS/.test(navigator.userAgent);
            
            addInfo(`–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${navigator.userAgent}`);
            addTest('iOS Device', isIOS);
            addTest('Safari Browser', isSafari);

            // Test icons
            const iconSizes = ['72x72', '96x96', '128x128', '144x144', '152x152', '167x167', '180x180', '192x192', '384x384', '512x512'];
            
            for (const size of iconSizes) {
                try {
                    const response = await fetch(`/push-app/icon-${size}.png`);
                    const iconDiv = document.createElement('div');
                    iconDiv.className = 'icon-item';
                    
                    if (response.ok) {
                        iconDiv.innerHTML = `
                            <img src="/push-app/icon-${size}.png" alt="${size}">
                            <div>${size}</div>
                            <div style="color: green;">‚úÖ</div>
                        `;
                    } else {
                        iconDiv.innerHTML = `
                            <div>${size}</div>
                            <div style="color: red;">‚ùå</div>
                        `;
                    }
                    
                    iconsContainer.appendChild(iconDiv);
                } catch (error) {
                    console.error(`Failed to load icon ${size}:`, error);
                }
            }

            // Test Apple touch icons
            const appleIcons = ['apple-touch-icon.png', 'favicon-32x32.png', 'favicon-16x16.png'];
            for (const icon of appleIcons) {
                try {
                    const response = await fetch(`/push-app/${icon}`);
                    addTest(`${icon} –¥–æ—Å—Ç—É–ø–Ω–∞`, response.ok);
                } catch (error) {
                    addTest(`${icon} –¥–æ—Å—Ç—É–ø–Ω–∞`, false, error.message);
                }
            }
        }

        // Run tests when page loads
        runTests();
    </script>
</body>
</html>
